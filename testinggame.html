<!DOCTYPE html>
<html>
<head>
    <title>Blocksonline 2D</title>
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-database-compat.js"></script>
    <style>
        body { text-align: center; background: #ccc; }
        canvas { background: white; }
    </style>
</head>
<body>
    <h1>Blocksonline 2D</h1>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBuWcUaYo9eah5mehCQ0h8bBnkE_251NKY",
            authDomain: "virtualblocks-b7a52.firebaseapp.com",
            databaseURL: "https://virtualblocks-b7a52-default-rtdb.firebaseio.com",
            projectId: "virtualblocks-b7a52",
            storageBucket: "virtualblocks-b7a52.firebasestorage.app",
            messagingSenderId: "490618182453",
            appId: "1:490618182453:web:93385819c7ff08537d8a7c"
        };

        firebase.initializeApp(firebaseConfig);

        const db = firebase.database();
        let uid = "";
        
        function login() {
            const email = prompt("Correo:");
            const password = prompt("ContraseÃ±a:");
            firebase.auth().signInWithEmailAndPassword(email, password)
                .then(userCredential => {
                    uid = userCredential.user.uid;
                    startGame();
                })
                .catch(error => console.error("Error:", error.message));
        }
        
        let players = {};
        let canvas = document.getElementById("gameCanvas");
        let ctx = canvas.getContext("2d");
        let playerImg = new Image();
        playerImg.src = "player.png"; // Reemplazar con la imagen del jugador

        function startGame() {
            db.ref("players/" + uid).set({ x: 100, y: 100 });
            db.ref("players").on("value", snapshot => {
                players = snapshot.val() || {};
                drawGame();
            });
            window.addEventListener("keydown", movePlayer);
        }
        
        function movePlayer(e) {
            let player = players[uid];
            if (!player) return;
            if (e.key === "ArrowUp") player.y -= 10;
            if (e.key === "ArrowDown") player.y += 10;
            if (e.key === "ArrowLeft") player.x -= 10;
            if (e.key === "ArrowRight") player.x += 10;
            db.ref("players/" + uid).set(player);
        }
        
        function drawGame() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (let id in players) {
                let p = players[id];
                ctx.drawImage(playerImg, p.x, p.y, 50, 50);
            }
        }

        firebase.auth().onAuthStateChanged(user => {
            if (user) { uid = user.uid; startGame(); }
            else login();
        });
    </script>
</body>
</html>
