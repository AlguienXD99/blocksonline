<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiplayer Blockbase - Virtualblocks</title>
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            height: 100%; 
            background-color: #87CEEB; /* Fondo azul cielo */
        }

        canvas { 
            display: block; 
        }

        /* Estilos para los botones de control */
        .mobile-controls {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
        }

        .control-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 20px;
            border-radius: 10px;
            cursor: pointer;
            margin: 5px;
        }

        /* Botones de control (Izquierda, Derecha, Arriba, Abajo, Salto) */
        #moveLeft { float: left; }
        #moveRight { float: right; }
        #moveUp { clear: both; }
        #moveDown { float: left; }

        /* Estilos para el botón de reportar */
        #reportButton {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1000;
            padding: 10px 20px;
            background-color: #ff6347;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        /* Estilos para el formulario de reporte */
        #reportForm {
            position: absolute;
            top: 50px;
            left: 10px;
            z-index: 1000;
            display: none;
            background-color: white;
            padding: 20px;
            border: 1px solid #000;
            border-radius: 5px;
        }

        #reportDescription {
            width: 300px;
            height: 100px;
        }

        button {
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:disabled {
            background-color: #ccc;
        }
    </style>
</head>
<body>
    <audio autoplay loop muted>
    <source src="https://gitlab.com/AlguienXD99/createfuntv/-/raw/main/punch.mp3" type="audio/mp3">
    Tu navegador no soporta el elemento de audio.
    </audio>
    <button onclick="window.close();">Salir del juego</button>

    <!-- Firebase SDK con módulos -->
    <script type="module">
        // Importación de Firebase desde CDN
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js';
        import { getDatabase, ref, set, onValue } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js';

        // Configuración de Firebase
const firebaseConfig = {
  apiKey: "AIzaSyBuWcUaYo9eah5mehCQ0h8bBnkE_251NKY",
  authDomain: "virtualblocks-b7a52.firebaseapp.com",
  databaseURL: "https://virtualblocks-b7a52-default-rtdb.firebaseio.com",
  projectId: "virtualblocks-b7a52",
  storageBucket: "virtualblocks-b7a52.firebasestorage.app",
  messagingSenderId: "490618182453",
  appId: "1:490618182453:web:93385819c7ff08537d8a7c"
};
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Generar un ID único para el jugador
        const playerId = Math.random().toString(36).substr(2, 9); // ID único para cada jugador

        // Referencia en la base de datos para los jugadores
        const playersRef = ref(database, 'players/' + playerId);

        // Configuración básica de Three.js
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Agregar luces
        const ambientLight = new THREE.AmbientLight(0x404040); // Luz suave
        const directionalLight = new THREE.DirectionalLight(0xffffff, 1); // Luz direccional
        directionalLight.position.set(5, 10, 5).normalize();
        scene.add(ambientLight);
        scene.add(directionalLight);

        // Crear el plano del suelo (baseplate)
        const baseplateGeometry = new THREE.PlaneGeometry(100, 100);
        const baseplateMaterial = new THREE.MeshLambertMaterial({ color: 0x808080, side: THREE.DoubleSide });
        const baseplate = new THREE.Mesh(baseplateGeometry, baseplateMaterial);
        baseplate.rotation.x = - Math.PI / 2;
        baseplate.position.y = -1;
        scene.add(baseplate);

        // Crear cuerpo del personaje (cabeza, torso, piernas)
        const bodyGeometry = new THREE.BoxGeometry(1, 2, 1);
        const headGeometry = new THREE.SphereGeometry(0.5, 32, 32);
        const legsGeometry = new THREE.BoxGeometry(0.8, 1, 1);
        const armsGeometry = new THREE.BoxGeometry(0.5, 1.5, 2);

        // Materiales iniciales
        const bodyMaterial = new THREE.MeshLambertMaterial({ color: '#00ff00' });
        let headMaterial = new THREE.MeshBasicMaterial({ color: '#f0f0f0' }); // Color predeterminado
        const legsMaterial = new THREE.MeshLambertMaterial({ color: '#ff0000' });
        const armsMaterial = new THREE.MeshLambertMaterial({ color: '#ff0000' });

        const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
        body.position.set(0, 1, 0);

        const head = new THREE.Mesh(headGeometry, headMaterial);
        head.position.set(0, 2.3, 0);

        const legs = new THREE.Mesh(legsGeometry, legsMaterial);
        legs.position.set(0, -0.5, 0);
        
        const arms = new THREE.Mesh(armsGeometry, armsMaterial);
        arms.position.set(0, 1.2, 0);

        // Agrupar partes del cuerpo
        const player = new THREE.Group();
        player.add(body);
        player.add(head);
        player.add(legs);
        player.add(arms);
        scene.add(player);

        // Función para actualizar la posición del jugador en Firebase
        function updatePlayerPosition() {
            set(playersRef, {
                position: {
                    x: player.position.x,
                    y: player.position.y,
                    z: player.position.z,
                    rotationY: player.rotation.y
                }
            });
        }

        // Detectar la posición del jugador en Firebase
        onValue(playersRef, (snapshot) => {
            const data = snapshot.val();
            if (data && data.position) {
                // Actualizar la posición del jugador desde Firebase
                player.position.set(data.position.x, data.position.y, data.position.z);
                player.rotation.y = data.position.rotationY;
            }
        });

        // Función de actualización
        function update() {
            // Movimiento del jugador
            if (moveForward) player.position.z -= speed;
            if (moveBackward) player.position.z += speed;
            if (moveLeft) player.position.x -= speed;
            if (moveRight) player.position.x += speed;

            if (isJumping) {
                player.position.y += 0.1; // Salto
                if (player.position.y >= originalY + jumpHeight) {
                    isJumping = false;
                }
            } else if (player.position.y > originalY) {
                player.position.y -= 0.1; // Caída
            }

            // Actualizar la posición en Firebase
            updatePlayerPosition();

            controls.update();
            renderer.render(scene, camera);
            requestAnimationFrame(update);
        }

        camera.position.z = 5;
        update();
    </script>
</body>
</html>
